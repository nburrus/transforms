<!DOCTYPE html>
<html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/86/three.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" 
integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" 
crossorigin="anonymous"></script> 
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<!-- Generated through https://www.bootstrap-live-customizer.com/ . First selecting the Cosmo theme. -->
<link rel="stylesheet" href="bootstrap.min.css">  

<style>
    /* Remove the spinner buttons on number input fields */
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    input[type="number"] {
        -moz-appearance: textfield;
        text-align:center;
    }
    
    /* Fixed size for our pretty float */
    .form-control.prettyFloat {
        display: inline-flex;
        margin-right: 0em;
        width: 6.5em;
    }
    
    .page-header {
        margin-top: 1em;
        margin-bottom: 1em;
    }
    
    .table.packed {
        width: auto;
        margin: 1em auto;
    }
    
    .table.packed td {
        vertical-align: middle;
        padding: 0;
        border: none;
    }
    
    .table.packed td.pr-2 {
        padding-right: 0.2em;
    }
    
    .verticallyCenter {
        display: flex;
        align-items: center;
        min-height: 10em;
        padding: 1em 0;
    }
    
    .row.equalColumnHeight {
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
    }    
    .row  { background-color: #e2e9e9; }
    .row.bg-1-2 { background-color: #7e9a9a; }
    
    @media only screen and (min-width : 481px) {
        .flex-row.row {
            display: flex;
            flex-wrap: wrap;
        }
        .flex-row.row > [class*='col-'] {
            display: flex;
            flex-direction: column;
        }
        .flex-row.row:after, 
        .flex-row.row:before {
            display: flex;
        }
    }
    
    .hide {
        display: none;
    }
    
    .col.bg-1-1 { background-color: #e2e9e9; }
    .col.bg-1-2 { background-color: #7e9a9a; }
    .col.bg-2-1 { background-color: #ffebcc; }
    .col.bg-2-2 { background-color: #f6d8ac; }
    .col.bg-2-1 { background-color: #ffb84d; }
    .col.bg-2-2 { background-color: #db9833; }
    .col.bg-3-1 { background-color: #40a5f2; }
    .col.bg-3-2 { background-color: #2a6592; }
    .col.bg-4-1 { background-color: #cce9ff; }
    .col.bg-4-2 { background-color: #8ec3eb; }
    
    .help-tip {
        display: inline-block;
        text-align: center;
        background-color: #aaaaaa;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        font-size: 16px;
        line-height: 32px;
        font-weight: bold;
        color:#fff;
        /*cursor: default;*/
    }
    
    .help-tip:hover {
        background: #fff;
        color:#aaaaaa;
    }
    
</style>

<script type="application/javascript">
    var state = {};
    state.aFromB = new THREE.Matrix4(); // the transform
    
    let matrixIndex = (r,c) => { return c*4+r; }
    let prettyFloat = (f) => { return Math.round(f*1e5) / 1e5; }
    let rad2deg = (v) => { return v*180.0/Math.PI; }
    let deg2rad = (v) => { return v*Math.PI/180.0; }
    
    let updateRotationMatrixView = function () {
        
        let elmToStr = (row,col) => {
            let v = state.aFromB.elements[matrixIndex(row,col)];
            return prettyFloat(v);
        };
        
        // Elements are stored in col-major mode, 4x4 matrix.        
        for (let row = 0; row < 3; ++row)
        for (let col = 0; col < 3; ++col)
        {
            let htmlValue = elmToStr(row,col);
            let htmlId = `#m${row}${col}`;
            $(htmlId).val(htmlValue);
        }
    };
    
    let updateEulerView = function () {
        
        let eulerAngles = new THREE.Euler();
        eulerAngles.setFromRotationMatrix(state.aFromB, 'ZYX');
        $('#euler-x').val(prettyFloat(rad2deg(eulerAngles.x)));
        $('#euler-y').val(prettyFloat(rad2deg(eulerAngles.y)));
        $('#euler-z').val(prettyFloat(rad2deg(eulerAngles.z)));
    };
    
    let updateViewFrom = function (from) {
        if (from != 'rotationMatrix') updateRotationMatrixView();
        if (from != 'eulerAngles') updateEulerView();
    };
    
    let onRotationMatrixChange = function () {        
        for (let row = 0; row < 3; ++row)
        {
            for (let col = 0; col < 3; ++col)
            {
                let htmlId = `#m${row}${col}`;
                state.aFromB.elements[matrixIndex(row,col)] = parseFloat($(htmlId).val());
            }
        }
        
        updateViewFrom ('rotationMatrix');
    };
    
    let onEulerChange = function () {
        let floatRadiansOrZero = id => { let v = document.getElementById(id).value; return v ? parseFloat(v)*Math.PI/180.0 : 0.0; };
        let euler = new THREE.Euler(floatRadiansOrZero("euler-x"), floatRadiansOrZero("euler-y"), floatRadiansOrZero("euler-z"), 'ZYX');
        state.aFromB.makeRotationFromEuler(euler);
        updateViewFrom ('eulerAngles');
    };
    
    let onInit = function () {
        for (let id of ['euler-x', 'euler-y', 'euler-z']) {
            $(`#${id}`).on('input', onEulerChange);
        }
        
        for (let row = 0; row < 3; ++row)
        for (let col = 0; col < 3; ++col)
        {
            $(`#m${row}${col}`).on('input', onRotationMatrixChange);
        }
        
        updateViewFrom ('init');
        
        // Enable popover on all the elements whose id ends with "-popover"
        // Automatically set their content to a hidden div with the
        // corresponding suffix "-popover-content".
        $("a[id*=-popover]").each(function() {
            let itemId = $(this).attr('id');
            $(this).popover({
                html : true,
                content: function() { return $(`#${itemId}-content`).html(); }
            });
        });
    }
    
    $( document ).ready(onInit);
</script>

<body>
    
    <div class="container">
        <div class="row">
            <div class="col bg-1-1">
                <div class="page-header">
                    <h1 class="text-center">3D Rotation Conversion</h1>
                </div>
            </div>
        </div>
        
        <div class="flex-row row bg-1-2">
            <div class="col-xs-24">
                <p> 
                    We are considering the rotation that goes from a coordinate 
                    system \(B\) to a coordinate system \(A\), noted \(AfromB\).
                    This notation allows to combine transforms without ambiguity,
                    e.g \(AfromC = AfromB * BfromC\), and applies naturally to
                    a point on the right: \(pointInA = AfromB * pointInB\)
                </p>
            </div>
        </div>
        
        <div class="flex-row row">
            <div class="col col-xs-24 col-sm-8 col-md-5 bg-4-1">
                <p><h4 class="text-center">Euler Angles</h4></p>
                <p class="text-center">
                    <a
                    title="Euler Angles"
                    id="euler-popover" 
                    data-toggle="popover" 
                    data-trigger="click"
                    data-placement="auto"><span class="help-tip">?</span>
                </a>
            </p>
            <div id="euler-popover-content" class="hide">
                <p>
                    They are defined in Z-Y-X, 
                    <a href="https://en.wikipedia.org/wiki/Euler_angles#Tait.E2.80.93Bryan_angles">Tait-Bryan</a>
                    , Intrinsics.<br>
                    \[AfromB = R(Z) * R(Y) * R(X)\]
                    This means that a point gets transformed by first applying the rotation
                    around X, then around the new Y, then around the new Z.
                </p>
            </div>
            <table class="table packed">
                <tr><td class="pr-2">X = </td><td><input type="number" class="form-control prettyFloat" id="euler-x" value=""/></td></tr>
                <tr><td class="pr-2">Y = </td><td><input type="number" class="form-control prettyFloat" id="euler-y" value=""/></td></tr>
                <tr><td class="pr-2">Z = </td><td><input type="number" class="form-control prettyFloat" id="euler-z" value=""/></td></tr>
            </table>
            <br>             
        </div>
        
        <div class="col col-xs-24 col-sm-8 col-md-5 bg-4-2 text-center">
            <p><h4 class="text-center">Angle Axis</h4></p>
            <p class="text-center">
                <a
                title="Angle Axis"
                id="angle-axis-popover" 
                data-toggle="popover" 
                data-trigger="click"
                data-placement="auto"><span class="help-tip">?</span>
            </a>
        </p>
        <div id="angle-axis-popover-content" class="hide">
            <p>
                The rotation is uniquely defined (up to the sign) by a unit axis [X,Y,Z] and an angle &Theta; around it.
            </p>
        </div>
        <table class="table packed">
            <tr><td class="pr-2">X = </td><td><input type="number" class="form-control prettyFloat" id="angle-axis-x" value=""/></td></tr>
            <tr><td class="pr-2">Y = </td><td><input type="number" class="form-control prettyFloat" id="angle-axis-y" value=""/></td></tr>
            <tr><td class="pr-2">Z = </td><td><input type="number" class="form-control prettyFloat" id="angle-axis-z" value=""/></td></tr>
            <tr><td>&Theta; = </td><td><input type="number" class="form-control prettyFloat" id="angle-axis-theta" value=""/></td></tr>
        </table>
        <br>             
    </div>
    
    <div class="col col-xs-24 col-sm-8 col-md-5 bg-3-1">
        <p><h4 class="text-center">Quaternion</h4></p>
        <p class="text-center">
            <a
            title="Quaternion"
            id="quaternion-popover" 
            data-toggle="popover" 
            data-trigger="click"
            data-placement="auto"><span class="help-tip">?</span>
        </a>
    </p>
    <div id="quaternion-popover-content" class="hide">
        <p>
            A unit quaternion is a unique (up to the sign) representation. Quaternions allow easy interpolation and composition.
            <a href="https://en.wikipedia.org/wiki/Quaternions_and_spatial_rotation">See the wikipedia page.</a>
        </p>
    </div>
    <table class="table packed">
        <tr><td class="pr-2">X = </td><td><input type="number" class="form-control prettyFloat" id="quaternion-x" value=""/></td></tr>
        <tr><td class="pr-2">Y = </td><td><input type="number" class="form-control prettyFloat" id="quaternion-y" value=""/></td></tr>
        <tr><td class="pr-2">Z = </td><td><input type="number" class="form-control prettyFloat" id="quaternion-z" value=""/></td></tr>
        <tr><td class="pr-2">W = </td><td><input type="number" class="form-control prettyFloat" id="quaternion-w" value=""/></td></tr>
    </table>
    <br>    
</div>

<div class="col col-xs-24 col-sm-24 col-md-9 bg-2-1">
    <p><h4 class="text-center">Rotation matrix 3x3</h4></p>
    <p class="text-center">
        <a
        id="rotation-matrix-popover" 
        title="Rotation matrix"
        data-toggle="popover" 
        data-trigger="click"
        data-placement="auto"><span class="help-tip">?</span>
    </a>
</p>
<div id="rotation-matrix-popover-content" class="hide">
    <p>
        Rotation matrices are 3x3. The row vectors are xxx.
    </p>
</div>
<table class="table packed">
    <tbody id="rotation-matrix-table">
        <tr>
            <td><input type="number" class="form-control prettyFloat" id="m00" value=""/></td>
            <td><input type="number" class="form-control prettyFloat" id="m01" value=""/></td>
            <td><input type="number" class="form-control prettyFloat" id="m02" value=""/></td>
        </tr>
        <tr>
            <td><input type="number" class="form-control prettyFloat" id="m10" value=""/></td>
            <td><input type="number" class="form-control prettyFloat" id="m11" value=""/></td>
            <td><input type="number" class="form-control prettyFloat" id="m12" value=""/></td>
        </tr>
        <tr>
            <td><input type="number" class="form-control prettyFloat" id="m20" value=""/></td>
            <td><input type="number" class="form-control prettyFloat" id="m21" value=""/></td>
            <td><input type="number" class="form-control prettyFloat" id="m22" value=""/></td>
        </tr>
    </tbody>
</table> 
</div>
</div>

</div>

</body>
</html>
